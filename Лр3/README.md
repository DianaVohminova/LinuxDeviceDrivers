# Лабораторная работа: Драйвер накопления энтропии

## Описание

Данная лабораторная работа реализует драйвер ядра Linux, который накапливает **энтропию** из различных источников:

- **Положение курсора мыши** (абсолютные и относительные движения).
- **Прерывания от клавиатуры** (нажатия и отпускания клавиш).
- **Время между нажатиями клавиш** (из пользовательского приложения).

Дополнительно реализовано **пользовательское приложение**, которое измеряет время между вводом строки и записывает его в файл, чтобы использовать как **дополнительный источник энтропии**.

---

## Структура проекта

- `entropy_collector.c` — исходный код ядерного драйвера.
- `keypress.c` — исходный код пользовательского приложения.
- `Makefile` — файл для сборки драйвера.
- `/tmp/entropy` — файл, в который записывается время ввода из приложения.

---

## Функционирование драйвера

### 1. Сбор энтропии из устройств ввода

- Драйвер **регистрирует обработчик** для всех устройств ввода (мышь, клавиатура).
- При **движении мыши** или **нажатии клавиш**:
  - Берётся текущее **время (`jiffies`)**.
  - Смешивается с **данными события** (например, координата или код клавиши) через **XOR**.
  - Результат передаётся в ядро через `add_device_randomness()`.

### 2. Логирование

- При каждом добавлении энтропии в `dmesg` выводится сообщение:
  ```
  Entropy added from mouse: ...
  Entropy added from keyboard: ...
  ```

---

## Функционирование приложения

- При запуске приложение:
  - Просит пользователя ввести строку.
  - Запоминает **время начала ввода**.
  - Ждёт завершения ввода.
  - Запоминает **время окончания ввода**.
  - Вычисляет **разницу в микросекундах**.
  - Выводит **введённую строку** и **время ввода**.
  - Записывает **время ввода** в файл `/tmp/entropy`.

---

## Сборка и запуск

### 1. Сборка драйвера

```bash
make clean
make
```

### 2. Загрузка драйвера в ядро

```bash
sudo insmod entropy_collector.ko
```

### 3. Проверка загрузки драйвера

```bash
lsmod | grep entropy_collector
```

### 4. Проверка логов драйвера

```bash
sudo dmesg | tail -5
```

Должны появиться строки:
```
Entropy added from mouse: ...
Entropy added from keyboard: ...
```

### 5. Запуск пользовательского приложения

```bash
./keypress
```

Приложение:
- Попросит ввести строку.
- Выведет, что вы ввели и сколько времени прошло.
- Запишет время ввода в `/tmp/entropy`.

### 6. Проверка содержимого файла энтропии

```bash
cat /tmp/entropy
```

### 7. Выгрузка драйвера

```bash
sudo rmmod entropy_collector
```

---

## Требования

- Установлены заголовки ядра:
  ```bash
  sudo apt install linux-headers-$(uname -r)
  ```

---

## Зависимости

- `linux/module.h`, `linux/input.h`, `linux/random.h` — для работы с ядром Linux.
- `sys/time.h` — для измерения времени в приложении.

---

## Автор

**Вожминова Диана**, 410Б-22, МАИ

---

## Лицензия

GPL v2 (как и ядро Linux)